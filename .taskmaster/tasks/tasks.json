{
  "master": {
    "tasks": [
      {
        "id": 9,
        "title": "Memoize AuthContext value and stabilize function refs",
        "description": "Optimize AuthContext to prevent unnecessary re-renders by memoizing the context value object and stabilizing function references",
        "details": "In `src/contexts/auth-context.jsx`, wrap the context value object in `useMemo` with dependencies on relevant state variables. Use `useCallback` to stabilize function references for `login`, `signup`, `loginWithGoogle`, `logout`, and `canEdit`. This prevents creating new objects on every render which causes all `useAuth()` consumers to re-render unnecessarily. Example: `const contextValue = useMemo(() => ({ user, loading, login: loginCallback, ... }), [user, loading, loginCallback, ...]);`",
        "testStrategy": "Use React DevTools Profiler to verify reduced re-renders of components using useAuth(). Test that authentication functions still work correctly after memoization.",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 10,
        "title": "Debounce search input using useDeferredValue",
        "description": "Implement search input debouncing to prevent filter computation from blocking typing",
        "details": "In `src/pages/home.jsx`, import `useDeferredValue` from React 18 and apply it to the search string state: `const deferredSearchTerm = useDeferredValue(searchTerm);`. Use the deferred value for filtering computations while keeping the immediate value for the input field. This allows typing to remain responsive while filtering happens in the background without blocking the UI.",
        "testStrategy": "Test typing performance with large datasets. Verify that search input remains responsive and filtering still works correctly. Use browser performance tools to confirm reduced main thread blocking.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 11,
        "title": "Memoize SummaryCard component",
        "description": "Wrap SummaryCard component with React.memo to prevent unnecessary re-renders during search/filter operations",
        "details": "In `src/components/summary-card.jsx`, wrap the component export with `React.memo`: `export default React.memo(SummaryCard);`. This prevents cards from re-rendering when their props haven't changed during search/filter operations. Ensure props are properly structured to take advantage of shallow comparison.",
        "testStrategy": "Use React DevTools Profiler to verify that SummaryCard components skip re-rendering when their individual props haven't changed during search operations. Test that card interactions still work correctly.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 12,
        "title": "Memoize parsed markdown in Summary page",
        "description": "Cache parsed markdown output to prevent re-parsing on every render",
        "details": "In `src/pages/summary.jsx`, wrap the `marked(summary.markdown)` call in `useMemo` with `summary.markdown` as the dependency: `const parsedMarkdown = useMemo(() => marked(summary.markdown), [summary.markdown]);`. This prevents expensive markdown parsing on every component render when only other state changes.",
        "testStrategy": "Verify that markdown content displays correctly and only re-parses when the markdown content actually changes. Test with large markdown documents to confirm performance improvement.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 13,
        "title": "Split summaries into meta and content collections",
        "description": "Create separate Firestore collections for metadata and content to reduce data transfer",
        "details": "In `src/lib/firebase.js`, create a new `summaries-meta` collection schema with fields: `gameTitle`, `createdAt`, `createdBy`, `originalFilename`, `bggLink`, `gameTitleLower` (string), `filenamesLower` (array), `bggLinkLower` (string). Update `saveSummary()` and `updateSummary()` to use `writeBatch()` for atomic writes to both collections. Modify `getAllSummaries()` to query `summaries-meta`. Update `getSummary(id)` to read from both collections and merge data. Keep existing `summaries` collection with only `markdown` field.",
        "testStrategy": "Test that all CRUD operations work correctly with the new dual-collection structure. Verify data consistency between collections. Test that existing functionality remains intact while reducing data transfer.",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 14,
        "title": "Create migration script for existing data",
        "description": "Build a Node.js script to migrate existing summaries data to the new collection structure",
        "details": "Create `scripts/migrate-summaries-meta.js` using Firebase Admin SDK. Read all documents from existing `summaries` collection, extract metadata fields, normalize text fields (lowercase), and write to `summaries-meta` collection using `writeBatch()` with 500-document batches (Firestore limit). Include error handling and progress logging. Script should be idempotent and handle partial failures gracefully.",
        "testStrategy": "Test migration script on a copy of production data. Verify all documents are migrated correctly with proper field normalization. Test script idempotency by running multiple times. Validate data integrity after migration.",
        "priority": "high",
        "dependencies": [
          13
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 15,
        "title": "Implement server-side duplicate detection",
        "description": "Replace client-side duplicate checking with efficient Firestore queries",
        "details": "In `src/lib/firebase.js`, replace `findSummariesByFilename()` with Firestore query: `collection('summaries-meta').where('filenamesLower', 'array-contains', filename.toLowerCase())`. Replace `findSummariesByBggLink()` with `collection('summaries-meta').where('bggLinkLower', '==', bggLink.trim().toLowerCase())`. Update `src/components/upload-form.jsx` to use these new functions while maintaining the same API interface.",
        "testStrategy": "Test duplicate detection with various filename formats and BGG links. Verify that case-insensitive matching works correctly. Test performance improvement by measuring query execution time vs previous full collection download.",
        "priority": "high",
        "dependencies": [
          13
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 16,
        "title": "Implement cursor-based pagination for home page",
        "description": "Add paginated loading to the home page to reduce initial data transfer",
        "details": "In `src/lib/firebase.js`, create `getSummariesPage(cursor, pageSize = 25)` function using `orderBy('createdAt', 'desc')`, `limit(pageSize)`, and optional `startAfter(cursor)` on `summaries-meta`. In `src/pages/home.jsx`, replace `getAllSummaries()` with paginated loading. Add 'Load more' button that fetches next page using the last document as cursor. Accumulate results in state array. Apply client-side search filtering only to currently loaded summaries.",
        "testStrategy": "Test pagination with various page sizes. Verify that 'Load more' functionality works correctly and maintains proper sort order. Test client-side filtering on paginated data. Verify performance improvement in initial page load time.",
        "priority": "high",
        "dependencies": [
          13
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 17,
        "title": "Add server-side 'Mine' filter with composite index",
        "description": "Implement efficient server-side filtering for user's own summaries",
        "details": "In `src/lib/firebase.js`, create `getMySummariesPage(uid, cursor, pageSize)` using `where('createdBy.uid', '==', uid)` + `orderBy('createdAt', 'desc')` + `limit(pageSize)` on `summaries-meta`. This requires creating a composite Firestore index: collection `summaries-meta`, fields `createdBy.uid` ASC + `createdAt` DESC. In `src/pages/home.jsx`, use this function when 'Mine' toggle is active instead of client-side filtering.",
        "testStrategy": "Create the required Firestore composite index. Test 'Mine' filter functionality with pagination. Verify that only user's summaries are returned. Test performance improvement vs client-side filtering on large datasets.",
        "priority": "medium",
        "dependencies": [
          13,
          16
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 18,
        "title": "Implement in-memory cache with TTL",
        "description": "Add caching layer for summary metadata queries to improve navigation performance",
        "details": "Create `src/lib/cache.js` or add to `src/lib/firebase.js` a simple cache using Map + timestamp with 60-second TTL. Cache key based on query parameters (cursor + mine filter). Implement cache invalidation on save/update/delete operations. Cache should store query results for `getSummariesPage()` and `getMySummariesPage()`. Include cache hit/miss logging for debugging.",
        "testStrategy": "Test cache functionality with various query combinations. Verify TTL expiration works correctly. Test cache invalidation on data mutations. Measure performance improvement for back-navigation scenarios.",
        "priority": "medium",
        "dependencies": [
          16
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 19,
        "title": "Implement route-based code splitting",
        "description": "Split heavy dependencies into separate chunks using React.lazy and Suspense",
        "details": "In `src/App.jsx`, use `React.lazy()` to dynamically import Upload and Summary pages: `const UploadPage = React.lazy(() => import('./pages/upload'));`. Wrap routes with `Suspense` component with appropriate fallback UI. Keep Home page eagerly loaded. This separates heavy dependencies (pdfjs-dist ~1.3MB, openai ~100KB, marked ~30KB) from the initial bundle.",
        "testStrategy": "Test that lazy-loaded routes work correctly with loading states. Verify bundle size reduction in initial chunk. Test that navigation between routes works smoothly with appropriate loading indicators.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 20,
        "title": "Configure Vite manual chunk splitting",
        "description": "Optimize bundle structure for better caching using manual chunk configuration",
        "details": "In `vite.config.js`, add `build.rollupOptions.output.manualChunks` configuration to create separate chunks: `react` chunk (react + react-dom), `firebase` chunk (firebase/app + firebase/auth + firebase/firestore), `router` chunk (react-router-dom). This enables long-term caching of vendor dependencies across deployments. Configure chunk naming for better cache invalidation.",
        "testStrategy": "Build the application and verify that separate vendor chunks are created as expected. Test that chunk loading works correctly in production. Verify improved caching behavior by checking that vendor chunks don't change between deployments when only application code changes.",
        "priority": "low",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "created": "2026-02-11T15:59:57.786Z",
      "updated": "2026-02-11T15:59:57.786Z",
      "description": "Tasks for master context"
    }
  }
}